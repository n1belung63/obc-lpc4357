# obc-lpc4357 
## Модуль регистрации и хранения данных на SD карте

Цель данного учебного проекта заключается в знакомстве с работой операционной системы реального времени на примере FreeRTOS и в получении опыта использования C++ на микроконтроллере.

Программа реализуется на микроконтроллере LPC4357 бортового компьютера платформы СамСат[^1]. Производится опрос бортовых датчиков (два чипа mpu9250) и запись их измерений в бортовое хранилище на две SD карты. Реализована вычитка данных с бортового хранилище по UART. Планируется добавить вычитку данных с SD карт по желаемым меткам времени и сжелаемым шагом.

[^1]: Первый спутник на платформе СамСат - [SamSat-ION](http://spaceresearch.ssau.ru/ru/samsat-ion) был запущен 27 июня 2023 года.

## План работ

- [x] Написать классы C++ обёрток на I2C, SPI, UART драйвера
- [x] Написать драйвера на SD карту, микрочип mpu9250 и расширитель порта
- [x] Сделать модуль инициализации аппаратных модулей устройства
- [ ] Сделать модуль обработки ошибок
- [x] Написать C++ обёртку на FreeRTOS, должен быть реализован функционал задач, очередей, событий
- [x] Реализовать в планировщике задачу для общения с устройством по UART
- [x] Написать на Python инфраструктуру для работы с устройством
- [x] Написать на Python тесты для проверки функционала отдельных модулей устройства
- [ ] Продумать конфиг хранилища данных на SD
- [ ] Реализовать в планировщике задачу для опроса датчика mpu9250 и записи его данных на SD
- [ ] Реализовать систему логирования и доступа к данным. Данные mpu9250 должны писаться в свой сектор. При перезагрузке данные должны продолжить писаться в память с места последней записи. По достижению конца сектора данные должны начать писаться заново. Доступ должен быть предоставлен по метке времени.
- [ ] Написать mock-тесты на C++ для проверки системы логирования и доступа к данным
- [ ] Добавить RAII к RTOS где требуется

## Блок-диаграмма програмного стека
![Alt text here](images/schema.svg)
